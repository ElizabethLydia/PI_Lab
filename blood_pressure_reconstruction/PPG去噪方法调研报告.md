# PPG信号去噪方法调研报告

## 📊 当前使用的通道分析

### 主要通道
- **IR通道 (Infrared)**: 红外光通道，主要用于PPG信号采集
- **Red通道**: 红光通道，辅助信号
- **Green通道**: 绿光通道，辅助信号，对运动敏感

### 为什么IR通道是主要的？
1. **穿透深度**: 红外光穿透组织更深，能更好地捕获动脉血流变化
2. **信噪比**: 相比可见光，红外光受环境光干扰更小
3. **生理相关性**: 与血氧饱和度和血压变化相关性更强

## 🔍 运动伪影去除效果不明显的原因分析

### 1. 实验条件
- **实验1**: 静止状态，运动占比仅1.7%
- **运动强度**: 轻微运动，加速度变化不大
- **阈值设置**: 当前阈值可能过于保守

### 2. 技术限制
- **简单插值**: 线性插值可能产生不自然的信号
- **阈值固定**: 静态阈值无法适应动态变化
- **孤立点处理**: 没有考虑运动段的连续性

## 🚀 新增去噪方法详解

### 1. **PCA去噪 (Principal Component Analysis)**
```python
def pca_denoising(self, signal_data, n_components=3):
```
**原理**: 将信号分段，通过主成分分析保留主要特征，去除噪声
**优点**: 
- 能有效去除随机噪声
- 保持信号的主要特征
- 适用于周期性信号
**缺点**: 
- 计算复杂度较高
- 可能丢失细节信息
**适用场景**: 噪声较大的PPG信号

### 2. **自适应滤波 (Adaptive Filter)**
```python
def adaptive_filter(self, signal_data, reference_signal, filter_length=32, mu=0.01):
```
**原理**: 使用LMS算法，根据参考信号自适应调整滤波器系数
**优点**: 
- 能自动适应信号变化
- 使用绿光通道作为参考（对运动敏感）
- 实时调整，动态适应
**缺点**: 
- 收敛速度依赖步长参数
- 可能不稳定
**适用场景**: 运动伪影去除，多通道融合

### 3. **EMD分解 (Empirical Mode Decomposition)**
```python
def emd_denoising(self, signal_data, max_imfs=5):
```
**原理**: 将信号分解为多个本征模态函数(IMF)，选择能量较大的重构
**优点**: 
- 完全数据驱动，无需预设基函数
- 能处理非平稳信号
- 自适应分解
**缺点**: 
- 需要安装PyEMD库
- 计算时间较长
**适用场景**: 非平稳PPG信号，复杂噪声环境

### 4. **卡尔曼滤波 (Kalman Filter)**
```python
def kalman_filter(self, signal_data, Q=0.1, R=1.0):
```
**原理**: 基于状态估计理论，预测-更新迭代去噪
**优点**: 
- 理论完备，数学基础扎实
- 能处理时变噪声
- 参数可调
**缺点**: 
- 需要设置过程噪声和测量噪声参数
- 对参数敏感
**适用场景**: 噪声统计特性已知的信号

### 5. **改进的运动伪影去除**
```python
def improved_motion_removal(self, ppg_signal, acc_data, window_size=100):
```
**改进点**:
- **动态阈值**: 使用滑动窗口计算局部阈值
- **形态学操作**: 去除孤立的运动点
- **智能插值**: 使用三次样条插值，更平滑
- **连续性检测**: 识别连续的运动段

## 🎯 带通滤波和小波变换图形显示问题分析

### 可能的原因：

1. **数据长度问题**: 
   - 信号太短，小波分解层数不够
   - 信号长度不是2的幂次，小波处理可能有问题

2. **参数设置问题**:
   - 小波类型不适合当前信号
   - 分解层数过高或过低

3. **异常值处理**:
   - 信号中有NaN或无穷大值
   - 信号幅度异常

### 解决方案：
- 添加异常值检测
- 调整小波参数
- 增加错误处理

## 📈 方法效果对比

### 静止状态 (实验1)
- **Butterworth滤波**: 效果一般，主要去除基线漂移
- **小波去噪**: 效果较好，去除随机噪声
- **运动伪影去除**: 效果不明显（运动少）
- **PCA去噪**: 效果较好，保持主要特征

### 运动状态 (其他实验)
- **运动伪影去除**: 效果显著
- **自适应滤波**: 效果较好，能适应运动变化
- **多通道融合**: 效果较好，综合利用各通道信息

## 🔧 参数调优建议

### Butterworth滤波
```python
# 当前: 0.5-4Hz
# 建议: 根据心率调整
lowcut = 0.5  # 最低心率约30bpm
highcut = 4.0 # 最高心率约240bpm
```

### 小波去噪
```python
# 当前: db4, level=4
# 建议: 根据信号长度调整
wavelet = 'db4'  # 适合PPG信号
level = min(4, int(np.log2(len(signal)/2)))
```

### 运动检测阈值
```python
# 当前: mean + 1.5*std
# 建议: 根据实验类型调整
threshold_factor = 1.5  # 静止实验可降低到1.2
```

## 🎯 推荐使用策略

### 1. **静止实验**
- 主要使用: 小波去噪 + PCA去噪
- 辅助使用: Butterworth滤波
- 可选: 卡尔曼滤波

### 2. **运动实验**
- 主要使用: 改进运动伪影去除 + 自适应滤波
- 辅助使用: 多通道融合
- 可选: EMD分解

### 3. **实时应用**
- 推荐: Butterworth滤波 + 简单运动检测
- 避免: PCA、EMD等计算密集型方法

## 📚 参考文献

1. **PPG信号处理**: "Photoplethysmography: Technology, Signal Analysis and Applications"
2. **小波去噪**: "Wavelet-based denoising for PPG signals"
3. **运动伪影去除**: "Motion artifact removal in PPG using accelerometer data"
4. **PCA应用**: "Principal component analysis for PPG signal denoising"
5. **自适应滤波**: "Adaptive filtering techniques for biomedical signals"

## 🔮 未来发展方向

1. **深度学习**: 使用CNN/LSTM进行端到端去噪
2. **多模态融合**: 结合ECG、EEG等其他生理信号
3. **实时优化**: 降低计算复杂度，提高实时性
4. **个性化**: 根据个体特征自适应调整参数
